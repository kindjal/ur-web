#!/bin/sh
# preinst script for ur-web
#
# see: dh_installdeb(1)

set -e

die () {
    echo $@
    exit 1
}

# summary of how this script can be called:
# * <preinst> install|upgrade

case "$1" in
    install|upgrade)
    # The www-data user is used for the webapp service.
    id -u www-data 2>&1 >/dev/null || \
        die "required user www-data doesn't exist"

    id -G www-data 2>/dev/null |  \
        grep -q local-systems  || \
        usermod -G local-systems www-data || \
        die "failed to add local-systems group to www-data"

    [ -d ~www-data ] || \
        mkdir -p ~www-data
    chown www-data: /var/log/ur-web/ur-web.log
    ;;

    *)
        echo "preinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

exit 0
